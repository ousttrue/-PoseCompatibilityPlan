```{index} vrm1
```

# vrm1

スキニングとポーズの分離のための試案。
別のモデル(スキニング)に対して、同じポーズを適用する。

```{note}
vrm0 では すべてのボーンがワールド座標と同じ向きの T-Pose からの local quaternion でこれを実現していた。
```

vrm1 では、T-Pose からの local euler 角でこれを実現するのを目標に
ボーンローカル回転を一定のルールの下で導入する。

## メリット

* 親指などあいまいだった部分が明確になる(予定)
* euler角でポーズがつけられる(予定)

## デメリット

* 初期セットアップが難しくなる
* importer を書くのが難しくなる
* export できるように前処理するのが難しくなる
* 仕様が長くなる
* runtime もポーズ変換機能が必要かも
* 既存の importer (Three-js, babylon, blender, unreal...etc も追随できるか？)

## 概要(T-Pose と ボーンローカル軸のトレードオフ)

`node` は以下の新しい制約を満たさなければならない。

* tail を示すノードが必用
* node の主軸を tail と直交する軸から選択する

Humanoid ボーンに関しては主軸の指定により、人体内での位置づけが分かるので、
モデルエクスポート時の `T-Pose` は不要となる。

`vrm0` では `T-Pose` からヒューマノイドボーンの座標系を決めていたが、
`vrm1` ではボーンの座標系から `T-Pose` を作ることができる。

## Bone座標系

以下の３軸を定義する。

* 主軸
* 副軸
* ロール軸

XYZ軸の具体的な割り当てはしないが、

Blenderでは

* X
* Z
* Y

となる。

humanoid の LeftLowerArm では、

* 主軸(肘の曲がる軸)
* 副軸(未使用)
* ロール軸(肘のロールする軸)

というように意味を固定する。

```{note}
左右の対称性の問題もここで記述する予定。
+の回転方向
```

T-Pose を基準ポーズとした、
右手系の ZXY Euler 角によるポーズを共有できるようにする。

```{note}
スキニングとリギングを切り離す。
glTFに格納され inverseMatrices は用いない。
import 時に 用途に応じたヒエラルキーを生成しそれにあわせて生成する。
(vrm0互換、nodeに格納されている回転、tail-axisから求められるもの)
```

```{warning}
warningの例です
```

右手系座標系 Y

これにより各ボーンの

```{blockdiag}

blockdiag {
   A -> B -> C;
   A -> E -> F;
}
```

